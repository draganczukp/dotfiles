#!/bin/zsh
export DISPLAY=:0.0

# ping -q -c1 1.1 > /dev/null || exit

offlineimap &>/dev/null

for account in $(ls ~/.mail); do
	newcount=$(find ~/.mail/$account/INBOX/new/ -type f -newer ~/.config/mutt/.mailsynclast 2> /dev/null | wc -l)
	if [ "$newcount" -gt "0" ]; then
		echo "New Mail" "$newcount new mail in mailbox $account" &
		notify-send "New Mail" "$newcount new mail in mailbox $account" &
		mpv --really-quiet ~/.config/mutt/notify.mp3 &
		echo $(date) >> /tmp/test
	fi
done

notmuch new &>/dev/null

touch ~/.config/mutt/.mailsynclast

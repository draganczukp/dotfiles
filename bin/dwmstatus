#!/bin/zsh

function batteries(){
	local STATUS=" "
	for bat in $(find /sys/class/power_supply -name "BAT*"); do
		STATUS="$STATUS|$(basename $bat) $(ischarging)$(cat $bat/capacity)%"
	done
	echo $STATUS
}

function ischarging(){
	cat /sys/class/power_supply/AC/online && echo ""
}

function volume(){
	local STATUS="|:"

	vol=$(pamixer --get-volume)
	[[ "$vol" = "0" ]] && STATUS="|(muted)" ||	STATUS="$STATUS $(pamixer --get-volume)%"
	echo $STATUS
}

function music(){
	local pStatus=$(playerctl status)

	[[ "$pStatus" = "Paused" ]] \
		&& STATUS="$STATUS()" \
		|| STATUS="$STATUS()"

	local artist=$(playerctl metadata artist)
	local title=$(playerctl metadata title)
	local STATUS="|$STATUS ${artist:0:15}: ${title:0:15}"

	$(playerctl status 2>&1 > /dev/null)
	[[ $? -eq 0 ]] && echo $STATUS
}

function cal(){
	local STATUS="|"
	apts=$(cat ~/.calcurse/apts)
	now=$(date +"%m/%d/%Y" | sed -r "s/.\$//")
	count=$(echo $apts | grep -i $now | wc -l)
	# echo $now $count
	STATUS="$STATUS : $count"
	[[ "$count" = "0" ]] ||	echo $STATUS
}

function status(){
	echo "$(music)$(volume)$(cal)$(ischarging)$(batteries)|$(date +'%H:%M:%S')"
}

[[ -v DEBUG ]] && echo $(status)

xsetroot -name "$(status)"
